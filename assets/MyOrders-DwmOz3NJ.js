import{_ as k,S as x,P as T,k as S,l as P,s as M,b as R,c as o,a as t,g as _,n as d,F as m,r as b,h as C,j as v,e as p,t as i,i as y,o as a}from"./index-DRJeTT8V.js";const U={components:{SearchBar:x,PaginationWrapper:T,Pagination:S,SelectBar:P},data(){return{myOrders:null,search:"",isLoading:"",pagination:{page:0,length:0,total:0,filtered:0,totalPages:0,start:0,end:0},paginationOptions:[{name:"Default",value:0},{name:"5",value:5},{name:"10",value:10},{name:"All",value:0}],ratingModalOneOrder:{},ratingModalTwoLesson:{},userRating:0,ratingMessage:"",user:{ipAddress:""}}},created(){this.getMyOrders()},methods:{async getMyOrders(){this.isLoading=!0;const l={search:this.search,...this.pagination};try{const s=`${this.$root.serverURL}order/myorders`,c=await M(s,l);this.pagination=c.pagination,this.paginationOptions[0].value=this.pagination.defaultLength,this.paginationOptions.at(-1).value=this.pagination.total,this.myOrders=c.orders,!this.search&&this.myOrders&&(this.user.ipAddress=this.myOrders[0].ip_address)}catch(s){this.myOrders=[],console.log(`Error getting orders: ${s}`)}this.isLoading=!1},async rateLesson(l){const s=l.target,c=s.innerHTML;s.disabled=!0,s.innerHTML=R;try{const g={lessonId:this.ratingModalTwoLesson._id,rating:this.userRating},e=`${this.$root.serverURL}lessons/rate`;(await M(e,g,"PUT")).ratingSuccessful&&(this.ratingMessage="Thanks for rating!",await this.getMyOrders(),this.ratingModalOneOrder=this.myOrders.filter(f=>f._id==this.ratingModalOneOrder._id)[0]||{})}catch(g){this.ratingMessage=g,console.log(g)}s.disabled=!1,s.innerHTML=c}},mounted(){document.querySelectorAll(".modal").forEach(l=>{new mdb.Modal(l)}),new mdb.Rating(document.querySelector(".rating"))},watch:{ratingModalTwoLesson(){document.querySelectorAll(".rating .fa-star").forEach(l=>{l.classList.remove("fas","active")})}}},B={class:"container my-5"},V=t("h1",{class:"fw-bolder mb-4 text-center"},"My Orders",-1),F={key:0,class:"text-center my-5"},A=t("div",{class:"spinner-border"},null,-1),j=[A],D={key:0},E={class:"table-responsive"},I={class:"table align-middle table-hover text-nowrap"},N=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Lessons"),t("th",null,"Name"),t("th",null,"Phone"),t("th",null,"IP Address"),t("th",null,"Datetime"),t("th",null,"Total Price"),t("th")])],-1),q={key:0},H=["onClick"],W=["onClick"],G={class:"mt-3 d-flex flex-column flex-lg-row justify-content-lg-between align-items-center gap-4"},z={key:1,class:"alert alert-danger",role:"alert"},K={key:0},J=t("strong",null,"name",-1),Q=t("strong",null,"phone",-1),X={class:"modal fade",id:"ratingModalOne",tabindex:"-1"},Y={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},Z={class:"modal-content rounded-7"},$=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Select a lesson"),t("button",{type:"button",class:"btn-close","data-mdb-ripple-init":"","data-mdb-dismiss":"modal"})],-1),tt={class:"modal-body p-0"},et={class:"table-responsive"},nt={class:"table align-middle table-hover text-nowrap mb-0"},st={class:"w-100"},ot=["onClick"],at={class:"modal fade",id:"ratingModalTwo",tabindex:"-1"},it={class:"modal-dialog modal-dialog-centered"},lt={class:"modal-content rounded-7"},rt=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Rate this lesson"),t("button",{type:"button",class:"btn-close","data-mdb-ripple-init":"","data-mdb-dismiss":"modal"})],-1),dt={class:"modal-body text-center"},ct={class:"mt-2 mb-3"},gt={class:"rating justify-content-center","data-mdb-rating-init":"","data-mdb-dynamic":"true"},ut=["title","onClick"],mt=["innerHTML"],ht={class:"modal-footer border-0 mx-auto"},_t={key:0,class:"btn btn-secondary","data-mdb-ripple-init":"","data-mdb-modal-init":"","data-mdb-target":"#ratingModalOne"},bt=["disabled"];function pt(l,s,c,g,e,r){const f=y("SearchBar"),w=y("Pagination"),L=y("SelectBar"),O=y("PaginationWrapper");return a(),o(m,null,[t("div",B,[V,_(f,{searchId:"myOrdersSearch",searchValue:e.search,"onUpdate:searchValue":s[0]||(s[0]=n=>e.search=n),isLoading:e.isLoading,"onUpdate:isLoading":s[1]||(s[1]=n=>e.isLoading=n),onSearchFunction:r.getMyOrders,class:"mb-4"},null,8,["searchValue","isLoading","onSearchFunction"]),e.myOrders?(a(),o("div",{key:1,class:d(["w-100",[e.isLoading?"placeholder bg-light":""]])},[e.myOrders.length?(a(),o("div",D,[t("div",E,[t("table",I,[N,t("tbody",null,[(a(!0),o(m,null,b(e.myOrders,(n,h)=>(a(),o("tr",{key:n._id},[t("td",null,i(h+e.pagination.start),1),t("td",null,[(a(!0),o(m,null,b(n.booked_lessons,u=>(a(),o("div",null,i(u.subject)+" (x"+i(u.quantity)+") ",1))),256))]),t("td",null,i(n.username),1),t("td",null,i(n.phone),1),t("td",null,i(n.ip_address),1),t("td",null,i(new Intl.DateTimeFormat("default",{dateStyle:"long",timeStyle:"short"}).format(new Date(n.datetime))),1),t("td",null,"AED "+i(n.total_price),1),t("td",null,[n.ip_address==e.user.ipAddress?(a(),o("div",q,[n.booked_lessons.length==1?(a(),o("button",{key:0,"data-mdb-ripple-init":"",class:d(`btn btn-sm btn${n.booked_lessons[0].my_rating?"-outline":""}-warning fw-bold w-100`),onClick:u=>{e.ratingModalOneOrder=n,e.ratingModalTwoLesson=n.booked_lessons[0],e.userRating=0,e.ratingMessage=""},"data-mdb-modal-init":"","data-mdb-target":"#ratingModalTwo"},i(n.booked_lessons[0].my_rating?`★ ${n.booked_lessons[0].my_rating}`:"Rate"),11,H)):(a(),o("button",{key:1,class:"btn btn-sm btn-warning w-100","data-mdb-ripple-init":"","data-mdb-modal-init":"","data-mdb-target":"#ratingModalOne",onClick:u=>e.ratingModalOneOrder=n}," Rate ",8,W))])):p("",!0)])]))),128))])])]),t("div",G,[_(O,{pagination:e.pagination,"onUpdate:pagination":s[5]||(s[5]=n=>e.pagination=n),label:"orders"},{default:C(()=>[_(w,{pagination:e.pagination,"onUpdate:pagination":s[2]||(s[2]=n=>e.pagination=n),isLoading:e.isLoading,"onUpdate:isLoading":s[3]||(s[3]=n=>e.isLoading=n),onPaginationFunction:r.getMyOrders},null,8,["pagination","isLoading","onPaginationFunction"]),_(L,{selectId:"ordersPerPage",options:e.paginationOptions,selectValue:e.pagination.length,"onUpdate:selectValue":s[4]||(s[4]=n=>e.pagination.length=n),onSelectFunction:r.getMyOrders,label:"Orders per page",group:!1},null,8,["options","selectValue","onSelectFunction"])]),_:1},8,["pagination"])])])):(a(),o("div",z,[t("span",{class:d({"fw-bold":!e.search})},"No order history found",2),e.search?p("",!0):(a(),o("span",K,[v(" in your current network. If you have ordered from a different network, try searching by your "),J,v(" or "),Q,v(". ")]))]))],2)):(a(),o("div",F,j))]),t("div",X,[t("div",Y,[t("div",Z,[$,t("div",tt,[t("div",et,[t("table",nt,[t("tbody",null,[(a(!0),o(m,null,b(e.ratingModalOneOrder.booked_lessons,n=>(a(),o("tr",null,[t("td",null,[t("i",{class:d(["fa-duotone fa-2x fa-fw",`${n.icon} text-${n.color}`])},null,2)]),t("th",st,i(n.subject),1),t("td",null,[t("button",{onClick:h=>{e.ratingModalTwoLesson=n,e.userRating=0,e.ratingMessage=""},class:d(`w-100 btn btn-sm btn${n.my_rating?"-outline":""}-warning`),"data-mdb-ripple-init":"","data-mdb-modal-init":"","data-mdb-target":"#ratingModalTwo"},i(n.my_rating?`★ ${n.my_rating}`:"Rate"),11,ot)])]))),256))])])])])])])]),t("div",at,[t("div",it,[t("div",lt,[rt,t("div",dt,[t("i",{class:d(["fa-duotone fa-3x fa-fw",`${e.ratingModalTwoLesson.icon} text-${e.ratingModalTwoLesson.color}`])},null,2),t("h5",ct,i(e.ratingModalTwoLesson.subject),1),t("ul",gt,[(a(),o(m,null,b(["Bad","Poor","OK","Good","Excellent"],(n,h)=>t("li",null,[t("i",{class:"fal fa-star fa-2x text-warning",title:n,onClick:u=>e.userRating=h+1},null,8,ut)])),64))]),e.ratingMessage?(a(),o("p",{key:0,class:"mt-3 mb-0",innerHTML:e.ratingMessage},null,8,mt)):p("",!0)]),t("div",ht,[e.ratingMessage?(a(),o("button",_t," Go back ")):p("",!0),t("button",{type:"button",class:"btn btn-warning","data-mdb-ripple-init":"",disabled:!e.userRating,onClick:s[6]||(s[6]=(...n)=>r.rateLesson&&r.rateLesson(...n))}," Rate ",8,bt)])])])])],64)}const ft=k(U,[["render",pt]]);export{ft as default};
